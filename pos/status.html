<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Order Status | å—é™µç¥­2026</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      /* =========================================
         1. Variables & Base (Copied from mobile-order.html)
         ========================================= */
      :root {
        /* Colors */
        --primary-color: #1a1a1a;   /* Deep Premium Black */
        --accent-color: #e53935;    /* Vibrant Red */
        --brand-color: #ff9800;     /* Warm Orange */
        --bg-color: #f0f2f5;        /* Modern App Background */
        --card-bg: #ffffff;
        
        /* Text */
        --text-main: #2d3436;
        --text-sub: #636e72;
        --font-main: "Noto Sans JP", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;

        /* Dimensions */
        --radius-lg: 20px;
        --radius-md: 16px;
      }

      body {
        background-color: #e2e8f0; /* Desktop bg color */
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        color: #333;
        height: 100dvh;
        width: 100vw;
        overflow: hidden; /* Prevent body scroll */
        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: center;
        margin: 0;
      }

      /* =========================================
         2. App Layout Container
         ========================================= */
      #app-container {
        width: 100%;
        max-width: 500px;
        height: 100%;
        flex: 1 1 auto;
        margin: 0 auto;
        overflow: hidden;
        background: var(--bg-color, #f8f9fa);
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        /* Subtle device boundary on PC */
        box-shadow: 0 0 40px rgba(0,0,0,0.1);
        border-right: 1px solid rgba(0,0,0,0.05); 
        border-left: 1px solid rgba(0,0,0,0.05);
        /* Default origin for scaling */
        transform-origin: top center;
      }

      @media (max-width: 500px) {
          #app-container {
              max-width: 100%;
              box-shadow: none;
          }
      }

      /* =========================================
         3. Status Page Specific Styles (McDonald's Style)
         ========================================= */
      /* Status Container acts as the 'screen' */
      .status-container {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start; /* Start from top */
        padding: 0;
        /* Padding bottom to clear bottom nav */
        padding-bottom: 160px; 
        text-align: center;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        width: 100%;
        background-color: #f8f9fa;
      }

      /* Main Header Message */
      .status-header-message {
        width: 100%;
        padding: 24px 20px 10px;
        text-align: center;
        font-size: 1.1rem;
        font-weight: 700;
        color: #1f2937;
      }

      /* White Card Container for Status */
      .status-card {
        background: white;
        width: 90%;
        border-radius: 20px;
        padding: 30px 20px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.04);
        margin-top: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        position: relative;
        /* overflow: hidden; Removed to prevent clipping of large fonts */
      }

      /* Colored Top Border */
      .status-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 6px;
        background: #e5e7eb;
        border-radius: 20px 20px 0 0; /* Match rounded corners */
      }
      .status-card.cooking::before { background: #E53935; }
      .status-card.prep::before { background: #3b82f6; }
      .status-card.done::before { background: #10b981; }

      /* Side-by-Side Layout */
      .status-main-row {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        width: 100%;
        margin-bottom: 20px;
      }
      .anim-col {
        flex: 0 0 120px; /* Fixed width for animation */
        display: flex;
        justify-content: center;
      }
      .num-col {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center; /* Center align for the number column */
        justify-content: center;
      }

      /* Adjusted SVG Size for side layout */
      .stick-svg {
        width: 110px;
        height: 110px;
        margin: 0; /* Remove bottom margin */
      }
      
      .stick-stroke {
        stroke: #374151; stroke-width: 3px; stroke-linecap: round; stroke-linejoin: round; fill: none;
      }
      .stick-head {
        fill: #374151; stroke: none;
      }
      .item-stroke {
        stroke: #3b82f6; stroke-width: 3px; stroke-linecap: round; stroke-linejoin: round; fill: none;
      }
      .item-fill {
        fill: #eff6ff; stroke: #3b82f6; stroke-width: 2px;
      }

      /* Animations Keyframes */
      @keyframes cookArm { from { transform: rotate(0deg); } to { transform: rotate(-15deg); } }
      .arm-cooking { transform-origin: 50px 45px; animation: cookArm 0.6s ease-in-out infinite alternate; }
      @keyframes cookFood { 0% { transform: translate(0, 0); opacity: 0; } 50% { opacity: 1; } 100% { transform: translate(5px, -15px) rotate(10deg); opacity: 0; } }
      .pan-content { opacity: 0; animation: cookFood 0.6s ease-in-out infinite; }

      @keyframes packArm { 0%, 100% { transform: rotate(0deg); } 40%, 60% { transform: rotate(20deg); } }
      .arm-packing { transform-origin: 50px 45px; animation: packArm 1.5s ease-in-out infinite; }
      @keyframes packItem { 0%, 20% { transform: translate(0, -20px); opacity: 0; } 40%, 60% { transform: translate(0, 0); opacity: 1; } 80%, 100% { transform: translate(0, 10px); opacity: 0; } }
      .item-packing { animation: packItem 1.5s ease-in-out infinite; }

      @keyframes wave { from { transform: rotate(-160deg); } to { transform: rotate(-130deg); } }
      .arm-wave { transform-origin: 50px 45px; animation: wave 1s ease-in-out infinite alternate; }
      @keyframes bagSway { from { transform: rotate(-5deg); } to { transform: rotate(5deg); } }
      .bag-hold { transform-origin: 70px 60px; animation: bagSway 2s ease-in-out infinite alternate; }
      @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-3px); } }
      .stick-man-done { animation: bounce 2s ease-in-out infinite; transform-origin: bottom center; }

      @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } 100% { opacity: 0.5; transform: scale(0.8); } }
      
      /* Order Number Adjustments */
      .big-number {
        font-size: 3.5rem; 
        margin-bottom: 0; /* Remove bottom margin */
        line-height: 1;
      }
      .label-order-num {
        margin-bottom: 5px;
        text-align: center;
      }

      /* Progress Bar (Stepper) */
      .progress-stepper {
        display: flex;
        justify-content: space-between;
        width: 100%;
        margin: 0 0 20px;
        position: relative;
      }
      /* Line behind steps */
      .progress-stepper::before {
        content: '';
        position: absolute;
        top: 14px;
        left: 10%;
        right: 10%;
        height: 3px;
        background: #e5e7eb;
        z-index: 0;
      }
      .step-item {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 33%;
      }
      .step-circle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #e5e7eb;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        font-weight: bold;
        transition: background 0.3s;
      }
      .step-label {
        margin-top: 6px;
        font-size: 0.7rem;
        font-weight: 700;
        color: #9ca3af;
      }
      
      /* Active State Styles */
      .step-item.active .step-circle { background: #1a1a1a; }
      .step-item.active .step-label { color: #1a1a1a; }
      .step-item.completed .step-circle { background: #10b981; }

      /* Dynamic Card Border Colors override active step color if needed */
      .status-card.cooking .step-item.active .step-circle { background: #E53935; }
      .status-card.prep .step-item.active .step-circle { background: #3b82f6; }
      .status-card.done .step-item.active .step-circle { background: #10b981; }
    </style>
  </head>
  <body data-status="waiting">
    <!-- App Container -->
    <div id="app-container">
      
      <!-- Sub Element that acts as the scrollable screen with themes -->
      <div class="status-container">
        
        <div class="status-header-message">
           ã”æ³¨æ–‡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™
        </div>

        <!-- Dynamic Status Card -->
        <div id="status-card" class="status-card cooking">
            
            <!-- Row: Animation (Left) + Number (Right) -->
            <div class="status-main-row">
                <div class="anim-col" id="anim-container">
                     <!-- Animation Injected Here -->
                     <div class="spinner-border text-primary" role="status"></div>
                </div>
                <div class="num-col">
                    <div class="label-order-num">ã”æ³¨æ–‡ç•ªå·</div>
                    <div id="display-number" class="big-number">----</div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-stepper" id="progress-stepper">
                <div class="step-item" id="step-cooking">
                    <div class="step-circle"><i class="bi bi-fire"></i></div>
                    <div class="step-label">èª¿ç†ä¸­</div>
                </div>
                <div class="step-item" id="step-prep">
                    <div class="step-circle"><i class="bi bi-box-seam"></i></div>
                    <div class="step-label">æº–å‚™ä¸­</div>
                </div>
                <div class="step-item" id="step-done">
                    <div class="step-circle"><i class="bi bi-megaphone"></i></div>
                    <div class="step-label">ãŠå‘¼å‡º</div>
                </div>
            </div>

            <div id="status-title" class="status-title">èª­ã¿è¾¼ã¿ä¸­...</div>
            <div id="status-desc" class="status-desc">
                æ³¨æ–‡æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™
            </div>
        </div>

        <!-- Store Info -->
        <div class="info-section">
            <div class="info-label">å—ã‘å–ã‚Šåº—èˆ—</div>
            <div class="info-card-row">
                <!-- Simple generic store icon or emoji -->
                <div class="store-icon-box" style="font-size: 2rem;">ğŸª</div>
                <div>
                    <div style="font-size: 0.8rem; color: #10b981; font-weight: bold; margin-bottom: 2px;">å–¶æ¥­ä¸­</div>
                    <div id="store-name-display" style="font-weight: 800; color: #1f2937;">---</div>
                    <div style="font-size: 0.75rem; color: #9ca3af;">Store ID: <span id="store-id-raw">--</span></div>
                </div>
            </div>
        </div>

        <!-- Item List -->
        <div class="item-list-container">
             <div class="info-label">æ³¨æ–‡å†…å®¹</div>
             <div style="background: white; border-radius: 16px; padding: 16px; box-shadow: 0 2px 10px rgba(0,0,0,0.03);">
                 <div id="items-list"></div>
                 <div class="total-price-row">
                     <span>åˆè¨ˆ</span>
                     <span id="total-price">Â¥0</span>
                 </div>
             </div>
        </div>

        <div class="mt-5 text-center mb-4">
             <div style="font-size:0.7rem; color:#9ca3af; margin-bottom:15px;">
                 æœ€çµ‚æ›´æ–°: <span id="last-updated">--:--:--</span>
             </div>
             <button onclick="location.reload()" class="btn btn-outline-secondary btn-sm rounded-pill px-4">
                 å†èª­ã¿è¾¼ã¿
             </button>
        </div>

      </div>
    
    </div><!-- End App Container -->

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
      import {
        initializeAppCheck,
        ReCaptchaV3Provider,
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app-check.js";
      import {
        getFirestore,
        doc,
        onSnapshot,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";
      import {
        getFunctions,
        httpsCallable,
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-functions.js";
      import {
        getMessaging,
        onMessage,
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-messaging.js";
      import {
        getAuth,
        onAuthStateChanged,
        signInWithPopup,
        GoogleAuthProvider,
      } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

      /* Import Shared Instance from auth.js to prevent "App already exists" error */
      import { app, auth, db } from "../main/auth.js";

      // AppCheck (Debug Token handled by devtools or console)
      // Note: Reusing same key as mobile-order
      const appCheck = initializeAppCheck(app, {
        provider: new ReCaptchaV3Provider(
          "6LeHxzIsAAAAAOIf0lXePHNpUkvYRdFtQw9osmIS"
        ),
        isTokenAutoRefreshEnabled: true,
      });

      // const db = getFirestore(app); // Imported from auth.js
      // const auth = getAuth(app);    // Imported from auth.js
      const functions = getFunctions(app, "asia-northeast1"); 
      const messaging = getMessaging(app);

      // --- Logic ---
      const params = new URLSearchParams(window.location.search);
      const orderId = params.get("orderId");

      if (!orderId) {
        document.getElementById("status-title").textContent = "Order ID Missing";
        document.getElementById("status-desc").textContent = "æ­£ã—ã„URLã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„";
        document.querySelector(".spinner-border").style.display = "none";
      } else {
        // PERMISSION FIX: Wait for Auth
        onAuthStateChanged(auth, (user) => {
          if (user) {
            startListener();
          } else {
            // Not logged in.
            document.getElementById("status-title").textContent = "èªè¨¼ãŒå¿…è¦ã§ã™";
            document.getElementById("status-desc").innerHTML =
              'æ³¨æ–‡æƒ…å ±ã®è¡¨ç¤ºã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚<br><button id="btn-login-status" class="btn btn-dark mt-3 rounded-pill px-4">ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹</button>';
            document.querySelector(".spinner-border").style.display = "none";

            document.getElementById("btn-login-status").onclick = () => {
              signInWithPopup(auth, new GoogleAuthProvider()).catch((e) =>
                alert(e.message)
              );
            };
          }
        });
      }

      function startListener() {
        console.log("Starting Firestore Listener for:", orderId);
        onSnapshot(
          doc(db, "orders", orderId),
          (docSnap) => {
            if (!docSnap.exists()) {
              console.log("Doc does not exist");
              document.getElementById("status-title").textContent = "Order Not Found";
              return;
            }
            const data = docSnap.data();
            console.log("Order Data Update:", data); 
            updateUI(data);
            fetchStoreName(data.storeId);
            
            // Update Timestamp
            const now = new Date();
            document.getElementById("last-updated").innerText = now.toLocaleTimeString();
          },
          (error) => {
            console.error("Snapshot Error:", error);
            if (error.code === 'permission-denied') {
                 document.getElementById("status-title").textContent = "ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“";
                 document.getElementById("status-desc").textContent = "å†èª­ã¿è¾¼ã¿ã‚’ãŠè©¦ã—ãã ã•ã„";
            } else {
                document.getElementById("status-title").textContent = "Error";
                document.getElementById("status-desc").textContent = error.message;
            }
          }
        );
      }

      function updateUI(data) {
        // 1. Order Number
        // Remove "No." prefix if present in the data (though data.receiptNumber is usually just the num)
        const numEl = document.getElementById("display-number");
        if (numEl) numEl.textContent = `${data.receiptNumber}`;

        // Store ID Raw
        const storeIdEl = document.getElementById("store-id-raw");
        if (storeIdEl) storeIdEl.textContent = data.storeId;

        // 2. Items List
        const list = document.getElementById("items-list");
        list.innerHTML = "";
        if (data.items) {
          data.items.forEach((item) => {
            const row = document.createElement("div");
            row.className = "order-item-row";
            const itemPrice = item.price || 0; 
            const itemQty = item.quantity || 0;
            // Simplified item display
            row.innerHTML = `
                <div style="flex:1;">
                    <div style="font-weight:700;">${item.name}</div>
                    <div style="font-size:0.8rem; color:#9ca3af;">æ•°é‡: ${itemQty}</div>
                </div>
                <div>Â¥${itemPrice * itemQty}</div>
            `;
            list.appendChild(row);
          });
        }
        document.getElementById("total-price").textContent = `Â¥${data.totalPrice}`;

        // 3. Status Transformation logic
        const status = data.status;
        const animContainer = document.getElementById("anim-container");
        const card = document.getElementById("status-card");
        const titleEl = document.getElementById("status-title");
        const descEl = document.getElementById("status-desc");

        // Status Mappings matches Implementation Plan
        let visualState = "cooking"; // default
        
        // "Ready to serve" aka Kitchen Done -> PREP (Bagging)
        if (status === "ready_to_serve") {
             visualState = "prep";
        } 
        // "Ready for pickup" aka Presenter Called -> CALLING (Wave)
        else if (status === "ready_for_pickup") {
             visualState = "calling";
        }
        // Completed -> DONE
        else if (status.startsWith("completed")) {
             visualState = "done";
        }
        else {
             // waiting, cooking, authorized, unpaid -> COOKING
             visualState = "cooking";
        }

        // --- Render SVG & Text & Progress Bar ---
        // Reset card classes
        card.className = "status-card"; 
        
        // Helper to set progress bar
        const setProgress = (activeId) => {
            const steps = ["step-cooking", "step-prep", "step-done"];
            let foundActive = false;
            steps.forEach(id => {
                const el = document.getElementById(id);
                el.classList.remove("active", "completed");
                if (id === activeId) {
                    el.classList.add("active");
                    foundActive = true;
                } else if (!foundActive) {
                    el.classList.add("completed");
                }
            });
        };

        if (visualState === "cooking") {
            card.classList.add("cooking");
            setProgress("step-cooking");
            titleEl.textContent = "ãŸã ã„ã¾ãŠä½œã‚Šã—ã¦ã„ã¾ã™ï¼";
            descEl.textContent = "ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«ç•ªå·ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰\nãŠå—ã‘å–ã‚Šãã ã•ã„";
            
            // SVG: Cooking
            animContainer.innerHTML = `
                <svg class="stick-svg" viewBox="0 0 100 100">
                    <circle cx="50" cy="30" r="8" class="stick-head"/>
                    <line x1="50" y1="38" x2="50" y2="70" class="stick-stroke"/>
                    <line x1="50" y1="70" x2="35" y2="95" class="stick-stroke"/>
                    <line x1="50" y1="70" x2="65" y2="95" class="stick-stroke"/>
                    <path d="M50 45 L30 55" class="stick-stroke"/>
                    <g class="arm-cooking">
                        <path d="M50 45 L70 55" class="stick-stroke"/>
                        <line x1="70" y1="55" x2="80" y2="55" class="stick-stroke"/>
                        <path d="M80 55 A10 10 0 0 0 95 55 Z" class="stick-stroke" fill="#e5e7eb"/>
                        <circle cx="87" cy="50" r="2" class="stick-head pan-content" fill="#ef4444"/>
                        <rect x="85" y="48" width="4" height="4" class="stick-head pan-content" style="animation-delay: 0.1s" fill="#f59e0b"/>
                    </g>
                </svg>
            `;

        } else if (visualState === "prep") { // Packing
            card.classList.add("prep");
            setProgress("step-prep");
            titleEl.textContent = "ã¾ã‚‚ãªããŠå‘¼ã³å‡ºã—";
            descEl.textContent = "å•†å“ã‚’æº–å‚™ã—ã¦ã„ã¾ã™\nã‚‚ã†å°‘ã€…ãŠå¾…ã¡ãã ã•ã„";

            // SVG: Packing
            animContainer.innerHTML = `
                <svg class="stick-svg" viewBox="0 0 100 100">
                    <line x1="60" y1="80" x2="100" y2="80" class="stick-stroke" style="stroke-width: 2; stroke: #9ca3af;"/>
                    <circle cx="40" cy="30" r="8" class="stick-head"/>
                    <line x1="40" y1="38" x2="40" y2="70" class="stick-stroke"/>
                    <line x1="40" y1="70" x2="25" y2="95" class="stick-stroke"/>
                    <line x1="40" y1="70" x2="55" y2="95" class="stick-stroke"/>
                    <path d="M75 80 L75 65 L90 65 L90 80 Z" class="item-fill"/>
                    <circle cx="82" cy="60" r="4" class="item-stroke item-packing" style="stroke: #ef4444; fill: #ef4444; border:none;"/>
                    <g class="arm-packing">
                        <path d="M40 45 L60 45 L75 55" class="stick-stroke" fill="none"/>
                    </g>
                </svg>
            `;

        } else if (visualState === "calling") { // Ready
            card.classList.add("done"); 
            setProgress("step-done");
            titleEl.textContent = "å•†å“å®Œæˆï¼";
            descEl.textContent = "ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã¸ãŠè¶Šã—ãã ã•ã„ï¼\nãŠã„ã—ãå¬ã—ä¸ŠãŒã‚Œï¼";

            // SVG: Waving
            animContainer.innerHTML = `
                <svg class="stick-svg" viewBox="0 0 100 100">
                    <g class="stick-man-done">
                        <circle cx="50" cy="30" r="8" class="stick-head"/>
                        <line x1="50" y1="38" x2="50" y2="70" class="stick-stroke"/>
                        <line x1="50" y1="70" x2="35" y2="95" class="stick-stroke"/>
                        <line x1="50" y1="70" x2="65" y2="95" class="stick-stroke"/>
                        <path d="M50 45 L70 60" class="stick-stroke"/>
                        <g class="bag-hold">
                            <path d="M70 60 L70 75 L85 75 L85 60 Z" class="item-fill"/>
                            <path d="M70 60 Q77 50 85 60" class="item-stroke" style="fill:none; stroke-width:2;"/>
                        </g>
                        <g class="arm-wave">
                            <path d="M50 45 L80 45" class="stick-stroke"/> 
                        </g>
                    </g>
                    <g>
                        <text x="20" y="30" font-size="20" fill="#fbbf24" style="animation: pulse 1s infinite;">âœ¨</text>
                        <text x="80" y="20" font-size="15" fill="#fbbf24" style="animation: pulse 1s infinite 0.5s;">âœ¨</text>
                    </g>
                </svg>
            `;
        }
        else if (visualState === "done") {
             card.classList.add("done");
             setProgress("step-done"); // Stay on done
             titleEl.textContent = "å—æ¸¡å®Œäº†";
             descEl.textContent = "ã”åˆ©ç”¨ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼\nç´ æ•µãªæ–‡åŒ–ç¥­ã‚’ï¼";
             animContainer.innerHTML = `
                <div style="font-size: 5rem; color: #10b981;">
                    <i class="bi bi-check-circle-fill"></i>
                </div>
             `;
        }
      }

      async function fetchStoreName(storeId) {
        try {
          const storeDoc = await getDoc(doc(db, "stores", storeId));
          if (storeDoc.exists()) {
             console.log("Store:", storeDoc.data().name);
             const name = storeDoc.data().name;
             const el = document.getElementById("store-name-display");
             if(el) el.textContent = name;
          }
        } catch (e) {}
      }

    </script>
    
    <!-- App Layout Scripts -->
    <script>
       // Scaling Logic (Copied from mobile-order.html)
       function adjustScale() {
          const app = document.getElementById("app-container");
          const isMobile = window.innerWidth <= 480;

          if (isMobile) {
             app.style.height = "100%";
             app.style.flex = "1";
             app.style.transform = "none";
             app.style.zoom = "1";
             app.style.marginTop = "0";
          } else {
             // PC/Tablet: Simulating a phone device
             // Available Height Calculation (Window - Header/Nav/Margins)
             const availableHeight = window.innerHeight - 180; 
             
             // Base Height (matching mobile-order)
             const baseHeight = 840;
             
             let scale = Math.min(1, availableHeight / baseHeight);
            
             // Fix dimensions to the base phone size, then scale it
             app.style.flex = "none";
             app.style.height = `${baseHeight}px`;
             
             app.style.transform = `scale(${scale})`;
             
             // Reset zoom if needed
             app.style.zoom = "1";
          }
       }
       
       window.addEventListener("resize", adjustScale);
       window.addEventListener("load", adjustScale);
       
       // App Shell Config
       window.CURRENT_PAGE = 'home'; // Default highlighting
    </script>
    <script type="module" src="../main/app-shell.js"></script>
  </body>
</html>
