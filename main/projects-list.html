<!--
  Nanryosai 2026
  Version: 0.1.0
  Last Modified: 2026-02-05
  Author: Nanryosai 2026 Project Team
-->
<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>企画一覧 | 南陵祭'26</title>
    <!-- Core Style (Shell) -->
    <link rel="stylesheet" href="style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .page-header {
        padding: 40px 20px 20px;
        text-align: center;
      }

      .page-title {
        font-size: 2rem;
        font-weight: 900;
        margin: 0;
        background: var(--primary-gradient);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
        animation: fadeInDown 0.8s ease-out;
      }

      /* Filter Section */
      .filter-section {
        background: var(--glass-bg);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--glass-border);
        border-radius: 24px;
        padding: 20px;
        margin: 0 20px 20px;
        max-width: 900px;
        margin-left: auto;
        margin-right: auto;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        animation: fadeInUp 0.8s ease-out 0.2s backwards;
      }

      .search-box-wrapper {
        width: 100%;
        max-width: 600px;
        margin: 0 auto 16px;
      }

      .search-input {
        width: 100%;
        padding: 10px 20px;
        font-size: 0.95rem;
        color: var(--text-main);
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 50px;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(var(--primary-rgb), 0.2);
      }

      .filter-group {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        margin-bottom: 10px;
        flex-wrap: wrap;
      }

      .filter-group:last-child {
        margin-bottom: 0;
      }

      .filter-label {
        color: var(--text-sub);
        font-weight: 700;
        font-size: 0.8rem;
        min-width: 40px;
        text-align: right;
      }

      .filter-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: center;
      }

      .filter-btn {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-sub);
        padding: 5px 14px;
        border-radius: 50px;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: 600;
        transition: all 0.2s ease;
      }

      .filter-btn:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      .filter-btn.active {
        background: var(--primary-gradient);
        color: white;
        border-color: transparent;
        box-shadow: 0 2px 8px rgba(var(--primary-rgb), 0.3);
      }

      /* Control Row */
      .control-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 900px;
        margin: 0 auto 16px;
        padding: 0 24px;
      }

      .sort-wrapper {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .sort-select {
        padding: 6px 12px;
        border-radius: 10px;
        border: 1px solid var(--border-color);
        background: var(--card-bg);
        color: var(--text-main);
        font-size: 0.85rem;
        font-weight: 600;
        cursor: pointer;
        outline: none;
      }

      .view-toggle-wrapper {
        display: flex;
        gap: 6px;
        background: var(--card-bg);
        padding: 4px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
      }

      .view-toggle-btn {
        background: transparent;
        border: none;
        color: var(--text-sub);
        width: 32px;
        height: 32px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
      }

      .view-toggle-btn.active {
        background: var(--item-fill);
        color: var(--primary-color);
        font-weight: bold;
      }

      [data-theme="dark"] .view-toggle-btn.active {
        background: rgba(255, 255, 255, 0.1);
      }

      /* Projects Grid Container */
      .projects-grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
        gap: 16px;
        padding: 0 20px 80px;
        max-width: 1200px;
        margin: 0 auto;
      }

      /* Compact List View */
      .projects-grid-container.list-view {
        grid-template-columns: 1fr;
        max-width: 800px;
        gap: 12px;
      }

      /* Project Card Base */
      .project-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        border-radius: 16px;
        overflow: hidden;
        transition:
          transform 0.3s ease,
          box-shadow 0.3s ease;
        display: flex;
        flex-direction: column;
        text-decoration: none;
        color: var(--text-main);
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        will-change: transform;
      }

      .project-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
        border-color: rgba(var(--primary-rgb), 0.3);
      }

      .card-image {
        height: 130px;
        overflow: hidden;
        position: relative;
      }

      .card-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.6s ease;
      }

      .project-card:hover .card-image img {
        transform: scale(1.08);
      }

      .card-content {
        padding: 12px;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
      }

      /* List View Refinement */
      .list-view .project-card {
        flex-direction: row;
        align-items: center;
        padding: 12px;
        border-radius: 18px;
        min-height: 100px;
      }

      .list-view .card-image {
        width: 80px;
        height: 80px;
        border-radius: 14px;
        flex-shrink: 0;
      }

      .list-view .card-content {
        padding: 0 0 0 16px;
        gap: 2px;
        justify-content: center;
      }

      .card-group-name {
        color: var(--primary-color);
        font-size: 0.7rem;
        font-weight: 700;
        margin-bottom: 2px;
        display: block;
      }

      [data-theme="dark"] .card-group-name {
        color: #a5b4fc;
      }

      .card-project-title {
        font-size: 1rem;
        font-weight: 800;
        margin: 0 0 4px;
        color: var(--text-main);
        line-height: 1.3;
      }

      .list-view .card-project-title {
        font-size: 1rem;
        margin: 0;
      }

      /* Place info */
      .card-place {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.75rem;
        color: var(--text-sub);
        margin-top: auto;
        padding-top: 8px;
      }

      .list-view .card-place {
        margin-top: 2px;
        padding-top: 0;
        font-size: 0.75rem;
      }

      .card-place i {
        color: var(--text-placeholder);
      }

      .card-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
        margin-top: 8px;
      }

      .list-view .card-tags {
        margin-top: 4px;
      }

      .card-tag {
        background: var(--item-fill);
        color: var(--text-sub);
        font-size: 0.7rem;
        font-weight: 600;
        padding: 2px 8px;
        border-radius: 6px;
        border: none;
      }

      .card-tag.highlight-tag {
        background: rgba(var(--primary-rgb), 0.1);
        color: var(--primary-color);
      }

      .card-catchphrase {
        font-size: 0.85rem;
        line-height: 1.5;
        margin-top: 6px;
        color: var(--text-sub);
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .list-view .card-catchphrase {
        display: none; /* Hide catchphrase in list view for compactness */
      }

      .card-button-wrapper {
        margin-top: 0;
        padding: 0 12px 14px;
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        justify-content: flex-end;
      }

      .list-view .card-button-wrapper {
        padding: 0;
        margin-left: auto;
        flex-wrap: wrap;
        align-items: center;
        justify-content: flex-end;
      }

      .btn-action {
        padding: 6px 14px;
        border-radius: 50px;
        font-size: 0.8rem;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.2s;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        white-space: nowrap;
      }

      .btn-details {
        background: var(--item-fill);
        color: var(--text-main);
        border: 1px solid var(--border-color);
      }

      .btn-details:hover {
        background: var(--border-color);
      }

      .btn-order {
        background: linear-gradient(135deg, #ff0080 0%, #ff5e62 100%);
        color: white;
        border: none;
        box-shadow: 0 4px 10px rgba(255, 0, 128, 0.2);
      }

      .btn-order:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(255, 0, 128, 0.3);
      }

      /* Mobile adjustments for List View to ensure it fits */
      @media (max-width: 480px) {
        .page-header {
          padding-top: 30px;
        }
        .page-title {
          font-size: 1.6rem;
        }
        .filter-section {
          padding: 16px;
          margin: 0 10px 16px;
        }
        .projects-grid-container {
          padding: 0 10px 80px;
        }

        .list-view .card-image {
          width: 60px;
          height: 60px;
        }
        .list-view .project-card {
          padding: 10px;
        }
        .list-view .card-project-title {
          font-size: 0.95rem;
        }
        /* Buttons stack vertically on small screens */
        .list-view .card-button-wrapper {
          flex-direction: column;
          align-items: stretch;
        }
        .list-view .card-button-wrapper .btn-action {
          width: 100%;
          padding: 8px 12px;
          font-size: 0.8rem;
          text-align: center;
        }
      }

      /* Animations */
      @keyframes fadeInDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes fadeInUp {
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .no-results {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-sub);
        grid-column: 1 / -1;
        display: none;
        font-weight: bold;
      }
      /* Skeleton Loading */
      @keyframes shimmer {
        0% {
          background-position: -200% 0;
        }
        100% {
          background-position: 200% 0;
        }
      }

      .skeleton {
        background: linear-gradient(
          90deg,
          var(--border-color) 25%,
          rgba(255, 255, 255, 0.2) 37%,
          var(--border-color) 63%
        );
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
        border-radius: 8px;
        color: transparent !important;
        user-select: none;
      }

      [data-theme="dark"] .skeleton {
        background: linear-gradient(
          90deg,
          rgba(255, 255, 255, 0.05) 25%,
          rgba(255, 255, 255, 0.1) 37%,
          rgba(255, 255, 255, 0.05) 63%
        );
      }

      .project-card.is-loading {
        pointer-events: none;
        box-shadow: none;
        border-color: transparent;
      }

      .project-card.is-loading .card-image {
        background: var(--card-bg); /* Fallback */
      }
    </style>
  </head>
  <body>
    <main>
      <div class="page-header">
        <h1 class="page-title">企画・展示一覧</h1>
      </div>

      <!-- Filter Section -->
      <div class="filter-section">
        <div class="search-box-wrapper">
          <input
            type="search"
            id="search-input"
            class="search-input"
            placeholder="企画名・団体名で検索..."
          />
        </div>

        <div class="filter-group">
          <span class="filter-label">団体</span>
          <div id="filter-by-grade" class="filter-buttons">
            <button class="filter-btn active" data-filter="すべて">
              すべて
            </button>
            <button class="filter-btn" data-filter="1年生">1年生</button>
            <button class="filter-btn" data-filter="2年生">2年生</button>
            <button class="filter-btn" data-filter="3年生">3年生</button>
            <button class="filter-btn" data-filter="部活動">部活動</button>
          </div>
        </div>

        <div class="filter-group">
          <span class="filter-label">ジャンル</span>
          <div id="filter-by-type" class="filter-buttons">
            <button class="filter-btn active" data-filter="すべて">
              すべて
            </button>
            <button class="filter-btn" data-filter="食品">食品</button>
            <button class="filter-btn" data-filter="展示">展示</button>
            <button class="filter-btn" data-filter="ゲーム">ゲーム</button>
            <button class="filter-btn" data-filter="アトラクション">
              アトラクション
            </button>
            <button class="filter-btn" data-filter="体験">体験</button>
          </div>
        </div>
      </div>

      <!-- Control Row -->
      <div class="control-row">
        <div class="sort-wrapper">
          <span
            style="font-size: 0.9rem; font-weight: 700; color: var(--text-sub)"
            >並び替え:</span
          >
          <select id="sort-select" class="sort-select">
            <option value="id-asc">クラス・団体順</option>
            <option value="name-asc">五十音順 (昇順)</option>
            <option value="floor-asc">場所・階数順</option>
          </select>
        </div>

        <div class="view-toggle-wrapper">
          <button
            class="view-toggle-btn"
            id="grid-view-btn"
            aria-label="Grid View"
          >
            <i class="fas fa-th-large"></i>
          </button>
          <button
            class="view-toggle-btn active"
            id="list-view-btn"
            aria-label="List View"
          >
            <i class="fas fa-list"></i>
          </button>
        </div>
      </div>

      <div class="projects-grid-container list-view" id="projects-grid">
        <!-- JS will inject cards here -->
      </div>

      <div id="no-results-message" class="no-results">
        該当する企画はありません
      </div>
    </main>

    <!-- Load External Data -->
    <script src="data/data.js"></script>
    <script type="module" src="app-shell.js"></script>

    <script>
      window.CURRENT_PAGE = "projects";

      document.addEventListener("DOMContentLoaded", () => {
        const gridContainer = document.getElementById("projects-grid");
        const noResultsMessage = document.getElementById("no-results-message");
        const searchInput = document.getElementById("search-input");
        const sortSelect = document.getElementById("sort-select");

        if (!gridContainer) return;

        let activeFilters = {
          grade: "すべて",
          type: "すべて",
          search: "",
          sort: "id-asc",
        };

        // Skeleton Generation
        function renderSkeletons(count = 9) {
          let html = "";
          for (let i = 0; i < count; i++) {
            html += `
                    <div class="project-card is-loading">
                        <div class="card-image skeleton" style="height: ${gridContainer.classList.contains("list-view") ? "80px" : "130px"}"></div>
                        <div class="card-content">
                            <span class="card-group-name skeleton" style="width: 50%; height: 1em; margin-bottom: 4px;"></span>
                            <h3 class="card-project-title skeleton" style="width: 80%; height: 1.2em; margin-bottom: 8px;"></h3>
                            <p class="card-catchphrase skeleton" style="width: 100%; height: 1em; margin-bottom: 4px;"></p>
                            <div class="card-place skeleton" style="width: 40%; height: 1em; margin-top: auto;"></div>
                        </div>
                    </div>
                    `;
          }
          gridContainer.innerHTML = html;
        }

        function renderCards(projects) {
          if (projects.length === 0) {
            gridContainer.innerHTML = "";
            noResultsMessage.style.display = "block";
            return;
          }

          noResultsMessage.style.display = "none";

          const cardsHTML = projects
            .map((project, index) => {
              const groupName =
                project.groupName || project.groupId || "参加団体";
              const imgSrc = `../images/${project.id}.png`;
              const catchphrase =
                project.catchphrase || project.description || "";
              const place = project.place || "会場未定";
              const tags = (project.tags || []).filter((tag) =>
                ["食品", "展示", "ゲーム", "アトラクション", "体験"].includes(
                  tag,
                ),
              );

              const tagsHTML = tags
                .map((tag) => `<span class="card-tag">${tag}</span>`)
                .join("");

              const isFood =
                project.contentType === "menu" || tags.includes("食品");
              const orderBtnHTML = isFood
                ? `<a href="../pos/mobile-order.html?store=${project.id}" class="btn-action btn-order"><i class="fas fa-shopping-cart"></i> オーダー</a>`
                : "";

              return `
                    <div class="project-card" style="animation-delay: ${index * 0.02}s">
                        <div class="card-image">
                            <img src="${imgSrc}" alt="${project.name}" onerror="this.onerror=null;this.src='../images/noimage.png'">
                        </div>
                        <div class="card-content">
                            <span class="card-group-name">${groupName}</span>
                            <h3 class="card-project-title">${project.name}</h3>
                            <p class="card-catchphrase">${catchphrase}</p>
                            <div class="card-place">
                                <i class="fas fa-map-marker-alt"></i> ${place}
                            </div>
                            <div class="card-tags">${tagsHTML}</div>
                        </div>
                        <div class="card-button-wrapper">
                            ${orderBtnHTML}
                            <a href="detail.html?id=${project.id}" class="btn-action btn-details">詳細</a>
                        </div>
                    </div>
                    `;
            })
            .join("");

          gridContainer.innerHTML = cardsHTML;
        }

        // Filter & Sort Logic
        function applyFiltersAndSort(useLoading = false) {
          if (typeof projectData === "undefined") return;

          if (useLoading) {
            renderSkeletons(9); // Show skeleton while processing/filtering
            // Simulate subtle delay for UX (and ensures render loop clear)
            setTimeout(() => {
              processDataAndRender();
            }, 400);
          } else {
            processDataAndRender();
          }

          function processDataAndRender() {
            // 1. 基本的な除外
            let result = projectData.filter(
              (p) => !p.tags || !p.tags.includes("ステージ"),
            );

            // 2. Filter
            if (activeFilters.grade !== "すべて") {
              result = result.filter((p) => {
                if (activeFilters.grade === "部活動")
                  return p.groupName && !p.groupName.match(/^[1-3]年/);
                return (
                  p.groupName &&
                  p.groupName.startsWith(activeFilters.grade.replace("生", ""))
                );
              });
            }
            if (activeFilters.type !== "すべて") {
              result = result.filter(
                (p) => p.tags && p.tags.includes(activeFilters.type),
              );
            }
            if (activeFilters.search) {
              const term = activeFilters.search.toLowerCase();
              result = result.filter(
                (p) =>
                  p.name.toLowerCase().includes(term) ||
                  (p.groupName && p.groupName.toLowerCase().includes(term)),
              );
            }

            // 3. Sort
            if (activeFilters.sort === "name-asc") {
              result.sort((a, b) => a.name.localeCompare(b.name, "ja"));
            } else if (activeFilters.sort === "id-asc") {
              result.sort(
                (a, b) => (parseInt(a.id) || 9999) - (parseInt(b.id) || 9999),
              );
            } else if (activeFilters.sort === "floor-asc") {
              result.sort((a, b) => {
                const floorA = a.floor || 99;
                const floorB = b.floor || 99;
                if (floorA !== floorB) return floorA - floorB;
                return (parseInt(a.id) || 9999) - (parseInt(b.id) || 9999);
              });
            }
            renderCards(result);
          }
        }

        searchInput?.addEventListener("input", (e) => {
          activeFilters.search = e.target.value.trim();
          applyFiltersAndSort(false); // No loading for type-ahead search
        });

        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.addEventListener("click", (e) => {
            const group = e.target.closest(".filter-buttons");
            group.querySelector(".active").classList.remove("active");
            e.target.classList.add("active");
            if (group.id === "filter-by-grade")
              activeFilters.grade = e.target.dataset.filter;
            if (group.id === "filter-by-type")
              activeFilters.type = e.target.dataset.filter;
            applyFiltersAndSort(true); // Show loading on filter change
          });
        });

        sortSelect?.addEventListener("change", (e) => {
          activeFilters.sort = e.target.value;
          applyFiltersAndSort(true); // Show loading on sort change
        });

        // View Toggle
        const gridBtn = document.getElementById("grid-view-btn");
        const listBtn = document.getElementById("list-view-btn");
        gridBtn?.addEventListener("click", () => {
          gridContainer.classList.remove("list-view");
          gridBtn.classList.add("active");
          listBtn.classList.remove("active");
          // Re-render to adjust image skeleton size if needed (or just CSS handles it)
          // renderCards not needed if content exists, but skeleton logic depends on class
        });
        listBtn?.addEventListener("click", () => {
          gridContainer.classList.add("list-view");
          listBtn.classList.add("active");
          gridBtn.classList.remove("active");
        });

        // Initial Render
        renderSkeletons(12);
        setTimeout(() => {
          applyFiltersAndSort(false);
        }, 600); // Initial load delay
      });
    </script>
  </body>
</html>
