<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ホーム | 南陵祭'26</title>
    <!-- Core Style (Shell) -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Page Specific Style -->
    <style>
        /* 
           Countdown Enhanced Styles 
        */
        .sp-only { display: none; }
        @media (max-width: 768px) { .sp-only { display: inline; } }

        /* Phase Container Switching */
        .countdown-phase {
            display: none; /* Hide all by default */
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        .countdown-phase.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* URGENT MODE (< 24h) */
        .countdown-urgent .time-value {
            color: #ff0055;
            text-shadow: 0 0 15px rgba(255, 0, 85, 0.4);
            animation: heartbeat 1.5s infinite;
        }

        .countdown-urgent .countdown-label {
            color: #ff0055;
            font-weight: 900;
            letter-spacing: 0.1em;
        }

        @keyframes heartbeat {
            0% { transform: scale(1); }
            5% { transform: scale(1.1); }
            10% { transform: scale(1); }
            15% { transform: scale(1.1); }
            50% { transform: scale(1); }
            100% { transform: scale(1); }
        }

        /* HAPPENING NOW MODE */
        .status-badge-large {
            display: inline-block;
            background: linear-gradient(135deg, #ff0080, #7928ca);
            color: white;
            font-size: 3rem;
            font-weight: 900;
            padding: 20px 60px;
            border-radius: 100px;
            box-shadow: 0 10px 40px rgba(255, 0, 128, 0.5);
            letter-spacing: 0.1em;
            margin-bottom: 20px;
            animation: pulse-glow 2s infinite;
            text-transform: uppercase;
            line-height: 1;
        }

        .status-badge-sub {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-main);
            display: block;
            margin-top: 10px;
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 0 0 rgba(255, 0, 128, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(255, 0, 128, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 0, 128, 0); }
        }

        /* ENDED MODE */
        .status-badge-ended {
            font-size: 2rem; /* Adjusted for Japanese text length */
            font-weight: 900;
            color: var(--text-sub);
            letter-spacing: 0.05em;
            opacity: 0.8;
            line-height: 1.4;
            word-break: keep-all;
        }

        /* Mobile Adjustments */
        @media (max-width: 768px) {
            .status-badge-large {
                font-size: 1.8rem;
                padding: 15px 40px;
            }
            .status-badge-ended {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    
    <!-- Header is injected here by JS -->

    <main>
        <section class="hero-container">
            <!-- Decorative Background Elements -->
            <div class="hero-decoration-orb orb-1"></div>
            <div class="hero-decoration-orb orb-2"></div>
            
            <div class="hero-content">
                <div class="hero-badge">2026.9.11-12</div>
                <h1 class="hero-title">南陵祭<br>2026</h1>
                <p class="hero-slogan">(スローガンを入れる)</p>
            </div>
        </section>

        <section class="countdown-container">
            <!-- Phase 1: Countdown (Normal & Urgent) -->
            <div id="phase-countdown" class="countdown-phase active">
                <h2 class="countdown-label">開催まであと</h2>
                <div class="timer-grid">
                    <div class="time-box">
                        <span class="time-value" id="days">00</span>
                        <span class="time-unit">DAYS</span>
                    </div>
                    <div class="time-box">
                        <span class="time-value" id="hours">00</span>
                        <span class="time-unit">HOURS</span>
                    </div>
                    <div class="time-box">
                        <span class="time-value" id="minutes">00</span>
                        <span class="time-unit">MINS</span>
                    </div>
                    <div class="time-box">
                        <span class="time-value" id="seconds">00</span>
                        <span class="time-unit">SECS</span>
                    </div>
                </div>
            </div>

            <!-- Phase 2: Happening Now -->
            <div id="phase-happening" class="countdown-phase">
                <div class="status-badge-large">
                    開催中
                </div>
                <span class="status-badge-sub">みなさまのご来場をお待ちしています</span>
            </div>

            <!-- Phase 3: Ended -->
            <div id="phase-ended" class="countdown-phase">
                <div class="status-badge-ended">
                    ご来場<br class="sp-only">ありがとうございました
                </div>
                <span class="status-badge-sub">本年度の南陵祭は終了しました</span>
            </div>
        </section>

        <!-- 
          ★ REAL-TIME INFO SECTION (DUMMY DATA) ★ 
          将来的にFirebase Status JSONからリアルタイム情報を取得して表示するエリアです。
          現在はデザイン確認用のダミーデータを表示しています。
          backend logic: Not implemented yet.
        -->
        <section class="realtime-container">
            <div class="section-header">
                <h2 class="section-title">リアルタイム情報</h2>
                <div class="live-badge-pulse">LIVE</div>
            </div>
            
            <div class="venue-grid">
                <!-- 体育館 (Dummy) -->
                <div class="venue-card">
                    <div class="venue-header">
                        <h3>体育館</h3>
                        <span class="status-badge live">開催中</span>
                    </div>
                    <div class="venue-body">
                        <p class="current-program">（現在調整中：ダミーデータ）</p>
                        <p class="next-program">Next: 準備中</p>
                    </div>
                </div>

                <!-- 音楽室 (Dummy) -->
                <div class="venue-card">
                    <div class="venue-header">
                        <h3>音楽室</h3>
                        <span class="status-badge preparing">準備中</span>
                    </div>
                    <div class="venue-body">
                        <p class="current-program">（現在調整中：ダミーデータ）</p>
                        <p class="next-program">Next: ―</p>
                    </div>
                </div>

                <!-- 視聴覚室 (Dummy) -->
                <div class="venue-card">
                    <div class="venue-header">
                        <h3>視聴覚室</h3>
                        <span class="status-badge ended">終了</span>
                    </div>
                    <div class="venue-body">
                        <p class="current-program">本日の公演は終了しました</p>
                        <p class="next-program">See you tomorrow!</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 
          ★ MOBILE ORDER PROMO SECTION ★ 
        -->
        <section class="mobile-order-promo">
            <div class="promo-card-gradient">
                <div class="promo-content-wrapper">
                    <div class="promo-badge-glass">モバイルオーダー</div>
                    <h2 class="promo-title-large">並ばずに、<br>スマホで注文。</h2>
                    <p class="promo-desc-text">
                        列に並ばずお好きな時間にご注文いただけます。<br>
                        当日の混雑を避けてスムーズに受け取り！
                    </p>
                    <a href="../pos/mobile-order.html" class="promo-btn-white">
                        <i class="fas fa-mobile-alt"></i>
                        モバイルオーダーを使う
                    </a>
                    
                    <a href="mobile-order-guide.html" class="promo-link-sub">
                        <i class="fas fa-shield-alt"></i>
                        <span>システムの安全性について</span>
                    </a>
                </div>
                
                <!-- CSS-only Phone Mockup -->
                <div class="promo-visual-mockup">
                    <div class="phone-mockup">
                        <div class="phone-notch"></div>
                        <div class="phone-screen">
                            <div class="screen-slideshow">
                                <!-- Slide 1: Takoyaki -->
                                <div class="app-icon-item">
                                    <div class="app-icon-box">
                                        🐙
                                    </div>
                                    <div class="app-icon-label">たこ焼き</div>
                                    <div class="app-icon-price">¥???</div>
                                </div>
                                <!-- Slide 2: Yakisoba -->
                                <div class="app-icon-item">
                                    <div class="app-icon-box">
                                        🍝
                                    </div>
                                    <div class="app-icon-label">焼きそば</div>
                                    <div class="app-icon-price">¥???</div>
                                </div>
                                <!-- Slide 3: Tapioca -->
                                <div class="app-icon-item">
                                    <div class="app-icon-box">
                                        🧋
                                    </div>
                                    <div class="app-icon-label">タピオカ</div>
                                    <div class="app-icon-price">¥???</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>




        </section>

        <!-- 
          ★ PROJECTS HIGHLIGHT SECTION (Horizontal Carousel) ★ 
        -->
        <section class="highlight-section">
            <div class="highlight-header">
                <h2 class="highlight-title">企画・展示 ハイライト</h2>
                <a href="projects-list.html" class="highlight-link">
                    すべて見る <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="highlight-carousel" id="carousel-projects">
                <!-- JS will inject cards here -->
            </div>
        </section>

        <!-- 
          ★ STAGE HIGHLIGHT SECTION (Horizontal Carousel) ★ 
        -->
        <section class="highlight-section">
            <div class="highlight-header">
                <h2 class="highlight-title">ステージ発表 ハイライト</h2>
                <a href="#" class="highlight-link">
                    タイムテーブル <i class="fas fa-arrow-right"></i>
                </a>
            </div>
            <div class="highlight-carousel" id="carousel-stage">
                <!-- JS will inject cards here -->
            </div>
        </section>

        <!-- 
          ★ OVERVIEW SECTION ★ 
        -->
        <section class="overview-section">
            <h2 class="scroller-title" style="text-align: center; margin-bottom: 24px;">開催概要</h2>
            
            <!-- Detail Table -->
            <div class="overview-card overview-padding">
                <div class="overview-grid">
                    <!-- Date & Time -->
                    <div class="overview-item">
                        <div class="overview-icon-box">
                            <i class="fas fa-calendar-day"></i>
                        </div>
                        <div class="overview-details">
                            <h3 class="overview-label">開催日時</h3>
                            <p class="overview-value-lg">2026年 9月11日(金)・12日(土)</p>
                            <p class="overview-sub-text">※一般公開は12日(土) 10:00-15:00</p>
                        </div>
                    </div>

                    <!-- Location -->
                    <div class="overview-item">
                        <div class="overview-icon-box">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="overview-details">
                            <h3 class="overview-label">場所</h3>
                            <p class="overview-value-lg">横浜南陵高等学校</p>
                            <a href="https://www.google.com/maps/place/%E7%A5%9E%E5%A5%88%E5%B7%9D%E7%9C%8C%E7%AB%8B%E6%A8%AA%E6%B5%9C%E5%8D%97%E9%99%B5%E9%AB%98%E7%AD%89%E5%AD%A6%E6%A0%A1/@35.394142,139.566861,15z/data=!4m6!3m5!1s0x60185038ec1dc97d:0xceb43f4967396a60!8m2!3d35.394142!4d139.566861!16s%2Fg%2F122d_05p?entry=ttu" target="_blank" class="overview-link">
                                <i class="fas fa-location-arrow"></i> アクセス方法を見る
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Divider -->
                <div class="overview-divider"></div>

                <!-- Notes Section -->
                <div class="overview-notes-section">
                    <h3 class="overview-notes-title">
                        <i class="fas fa-exclamation-triangle"></i> 注意事項
                    </h3>
                    <ul class="overview-note-list-styled">
                        <li>
                            <span class="note-number">1</span>
                            <span class="note-text">お車での来場はご遠慮ください。</span>
                        </li>
                        <li>
                            <span class="note-number">2</span>
                            <span class="note-text">当日の入場は正門のみです。必ず受付をしてください。</span>
                        </li>
                        <li>
                            <span class="note-number">3</span>
                            <span class="note-text">校内は土足の一足制です。</span>
                        </li>
                        <li>
                            <span class="note-number">4</span>
                            <span class="note-text">体育館へ入場される際は、床を傷つける恐れのあるお履き物(ハイヒール等)はご遠慮ください。</span>
                        </li>
                        <li>
                            <span class="note-number">5</span>
                            <span class="note-text">写真撮影・ビデオ撮影はご遠慮ください。</span>
                        </li>
                        <li>
                            <span class="note-number">6</span>
                            <span class="note-text">敷地内は全面禁煙です。また、近隣住宅街での喫煙もご遠慮ください。</span>
                        </li>
                        <li>
                            <span class="note-number">7</span>
                            <span class="note-text">お支払いは基本的にauPayのみになります。</span>
                        </li>
                        <li>
                            <span class="note-number">8</span>
                            <span class="note-text">auPayに関するご質問は校門横のauPayブースで受け付けています。</span>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer is injected here by JS -->

    <!-- Load External Data -->
    <script src="data/data.js"></script>
    
    <script>
        // Define current page for the shell
        window.CURRENT_PAGE = 'home';

        // Countdown Logic (Enhanced)
        const START_DATE = new Date('2026-09-11T09:00:00+09:00').getTime();
        const END_DATE   = new Date('2026-09-12T18:00:00+09:00').getTime(); // End of After-party

        function updateCountdown() {
            const now = new Date().getTime();
            
            // Phase Elements
            const phaseCountdown = document.getElementById('phase-countdown');
            const phaseHappening = document.getElementById('phase-happening');
            const phaseEnded     = document.getElementById('phase-ended');

            // --- Debug Mode (URL Params) ---
            const urlParams = new URLSearchParams(window.location.search);
            const debugMode = urlParams.get('mode');

            if (debugMode) {
                if (debugMode === 'live') {
                    switchPhase(phaseHappening);
                    return;
                }
                if (debugMode === 'ended') {
                    switchPhase(phaseEnded);
                    return;
                }
                if (debugMode === 'urgent') {
                    // Force urgent countdown style (fake 1 hour remaining)
                    switchPhase(phaseCountdown);
                    phaseCountdown.classList.add('countdown-urgent');
                    // Mock display for visual check
                    document.getElementById('days').innerText = "00";
                    document.getElementById('hours').innerText = "00";
                    document.getElementById('minutes').innerText = "59";
                    document.getElementById('seconds').innerText = (59 - (new Date().getSeconds())).toString().padStart(2, '0');
                    return;
                }
            }

            // --- Phase Determination ---
            
            // 1. ENDED
            if (now > END_DATE) {
                switchPhase(phaseEnded);
                return;
            }

            // 2. HAPPENING NOW (Start <= Now <= End)
            if (now >= START_DATE && now <= END_DATE) {
                switchPhase(phaseHappening);
                return;
            }

            // 3. BEFORE START (Countdown Mode)
            switchPhase(phaseCountdown);
            
            const distance = START_DATE - now;

            // Urgent Mode Check (Within 24 Hours)
            const hoursUntilStart = distance / (1000 * 60 * 60);
            if (hoursUntilStart < 24) {
                phaseCountdown.classList.add('countdown-urgent');
            } else {
                phaseCountdown.classList.remove('countdown-urgent');
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById('days').innerText = days.toString().padStart(2, '0');
            document.getElementById('hours').innerText = hours.toString().padStart(2, '0');
            document.getElementById('minutes').innerText = minutes.toString().padStart(2, '0');
            document.getElementById('seconds').innerText = seconds.toString().padStart(2, '0');
        }

        function switchPhase(activeElement) {
            const phases = [
                document.getElementById('phase-countdown'),
                document.getElementById('phase-happening'),
                document.getElementById('phase-ended')
            ];

            phases.forEach(el => {
                if (el === activeElement) {
                    if (!el.classList.contains('active')) {
                        el.classList.add('active');
                    }
                } else {
                    el.classList.remove('active');
                }
            });
        }

        setInterval(updateCountdown, 1000);
        updateCountdown(); // Initial call

        // Vertical Auto-Scroll Logic (Infinite Loop)
        function setupHighlightAutoScroll(containerId, data) {
            const container = document.getElementById(containerId);
            if (!container || !data || data.length === 0) return;

            // Generate Card HTML Helper
            const generateCardsHTML = (items) => {
                return items.map(item => {
                    const groupName = item.groupName || item.groupId || '参加団体';
                    const imgSrc = `../images/${item.id}.png`;
                    const tags = item.tags ? item.tags.slice(0, 2) : [];
                    const tagsHTML = tags.map(tag => `<span class="highlight-tag">${tag}</span>`).join('');
                    
                    return `
                    <a href="#" class="highlight-card">
                        <img src="${imgSrc}" class="highlight-card-img" onerror="this.onerror=null;this.src='../images/noimage.png'">
                        <div class="highlight-card-content">
                            <span class="highlight-group-name">${groupName}</span>
                            <h3 class="highlight-project-name">${item.name}</h3>
                            <div class="highlight-place">
                                <i class="fas fa-map-marker-alt"></i> ${item.place}
                            </div>
                            <div class="highlight-tags">${tagsHTML}</div>
                        </div>
                    </a>
                `}).join('');
            };

            const cardsHTML = generateCardsHTML(data);
            // Triple content for seamless bidirectional loop
            container.innerHTML = cardsHTML + cardsHTML + cardsHTML;

            // --- Infinite Loop Logic ---
            let singleSetHeight = 0;
            let isUserInteracting = false;
            let scrollTimeout = null;

            // Calculate single set height after render
            // We use a slight delay or RAF to ensure DOM is ready
            requestAnimationFrame(() => {
                // Approximate height: total scrollHeight / 3
                singleSetHeight = container.scrollHeight / 3;
                // Start position at the beginning of the middle set
                container.scrollTop = singleSetHeight;
            });

            // Boundary Check
            const checkScrollPosition = () => {
                if (singleSetHeight === 0) return;
                
                const scrollTop = container.scrollTop;
                // If we reach the bottom of the middle set (start of 3rd set), jump back to start of 2nd set
                // Or if we go too high, jump forward.
                // Simpler logic: if scrollTop >= singleSetHeight * 2, subtract singleSetHeight
                // if scrollTop <= 0, add singleSetHeight.

                if (scrollTop >= singleSetHeight * 2) {
                    container.scrollTop = scrollTop - singleSetHeight;
                } else if (scrollTop <= 10) { // buffer near top
                     container.scrollTop = scrollTop + singleSetHeight;
                }
            };

            // Listen for user scroll to pause/resume and check bounds
            container.addEventListener('scroll', () => {
                // If user is manually scrolling, we consider it interaction
                // But the 'scroll' event also fires during auto-scroll. 
                // Checks logic in autoScroll loop.
                checkScrollPosition();
            });

            // --- Auto Scroll Animation ---
            const speedPxPerFrame = 0.5; // Adjust speed here
            let animationId = null;

            const animate = () => {
                if (!isUserInteracting) {
                    container.scrollTop += speedPxPerFrame;
                }
                animationId = requestAnimationFrame(animate);
            };
            
            // Start Animation
            animationId = requestAnimationFrame(animate);

            // --- Interaction Handling (Pause on Hover/Touch) ---
            const pause = () => { isUserInteracting = true; };
            const resume = () => { isUserInteracting = false; };

            container.addEventListener('mouseenter', pause);
            container.addEventListener('mouseleave', resume);
            container.addEventListener('touchstart', pause, { passive: true });
            container.addEventListener('touchend', resume);
        }

        // Initialize Carousels
        document.addEventListener('DOMContentLoaded', () => {
             if (typeof projectData !== 'undefined') {
                const filteredProjects = projectData.filter(item => {
                    return !item.tags || !item.tags.includes('ステージ');
                });
                setupHighlightAutoScroll('carousel-projects', filteredProjects);
            }
            if (typeof stageData !== 'undefined') {
                setupHighlightAutoScroll('carousel-stage', stageData);
            }
        });
    </script>
    <!-- App Shell Logic -->
    <script type="module" src="app-shell.js"></script>
</body>
</html>
